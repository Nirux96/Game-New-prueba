<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Game</title>
  <link rel="stylesheet" href="static/client/game.css">
</head>
<script src="static/client/pixi/pixi.min.js"></script>
<script src="socket.io/socket.io.js"></script>
<script src="static/client/controller.js"></script>

<body>
  <button id="fullscreenBtn" style="position: fixed; top: 10px; left: 10px; z-index: 1000; padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">ðŸŽ® Fullscreen</button>
  <script>
"use strict";
let leaderboard = [];
var controller = new Controller();

</script><script src="static/client/view.js"></script><script>
function Terrain(pathArg)  {
  this.path=pathArg;
}
document.body.appendChild(app.view);

let gameMap = new GameMap();
let players = [];
let bullets = [];
let items = [];
let currentPlayer = new CurrentPlayer();

////////////////////////////////////////////////////////////////////////////////
let socket = io();

let input = {
  up: false,
  down: false,
  left: false,
  right: false,
  direction:  Math.PI,
  LMB: false,
}

document.addEventListener('keydown', function(event) {
  switch (event.keyCode) {
    case 65: // A
    input.left = true;
    break;
    case 87: // W
    input.up = true;
    break;
    case 68: // D
    input.right = true;
    break;
    case 83: // S
    input.down = true;
    break;
  }
});

document.addEventListener('keyup', function(event) {
  switch (event.keyCode) {
    case 65: // A
    input.left = false;
    break;
    case 87: // W
    input.up = false;
    break;
    case 68: // D
    input.right = false;
    break;
    case 83: // S
    input.down = false;
    break;
  }
});

document.addEventListener('mousemove', function(event) {
  let arg=(event.y-controller.height/2 - controller.padding)/(event.x-controller.width/2-controller.padding);
  if (event.x>=controller.width/2 +controller.padding )
    currentPlayer.direction = Math.atan(arg);
  else
    currentPlayer.direction = Math.PI-Math.atan((-1)*arg);
  input.direction=currentPlayer.direction;
  }
);

document.addEventListener("mousedown", function() {
    input.LMB=true;
});
document.addEventListener("mouseup", function() {
    input.LMB=false;
});

// Fullscreen button functionality
document.getElementById('fullscreenBtn').addEventListener('click', function() {
    if (!document.fullscreenElement) {
        // Enter fullscreen
        document.documentElement.requestFullscreen().then(() => {
            this.textContent = 'ðŸšª Exit Fullscreen';
            this.style.background = '#f44336';
            
            // Resize the game when entering fullscreen
            setTimeout(() => {
                controller.width = window.innerWidth;
                controller.height = window.innerHeight;
                app.renderer.resize(window.innerWidth, window.innerHeight);
            }, 100);
        }).catch(err => {
            console.error('Error attempting to enable fullscreen:', err.message);
        });
    } else {
        // Exit fullscreen
        document.exitFullscreen().then(() => {
            this.textContent = 'ðŸŽ® Fullscreen';
            this.style.background = '#4CAF50';
            
            // Resize the game when exiting fullscreen
            setTimeout(() => {
                controller.width = window.innerWidth - 80;
                controller.height = window.innerHeight - 80;
                app.renderer.resize(controller.width, controller.height);
            }, 100);
        });
    }
});

// Handle fullscreen change events
document.addEventListener('fullscreenchange', function() {
    const btn = document.getElementById('fullscreenBtn');
    if (!document.fullscreenElement) {
        btn.textContent = 'ðŸŽ® Fullscreen';
        btn.style.background = '#4CAF50';
    }
});

// Handle window resize
window.addEventListener('resize', function() {
    if (document.fullscreenElement) {
        controller.width = window.innerWidth;
        controller.height = window.innerHeight;
    } else {
        controller.width = window.innerWidth - 80;
        controller.height = window.innerHeight - 80;
    }
    app.renderer.resize(controller.width, controller.height);
});

</script>

</body>
</html>
